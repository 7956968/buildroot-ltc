<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="generator" content="Doxygen 1.8.6"/>
<title>ISP DDK: Sensor Module Implementation Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.min.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="open-sans-font.css" rel="stylesheet" type="text/css" />
<link href="IMGdoxygen.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="img.ico">
</head>
<body>
<div id="HeaderContainer">
    <div id="Header">
        <div id="HeaderContent">
            <div id="HeaderLogo">
                <a href="../../index.html"><img src="doc-logo.png" /></a>
            </div>
            <div id="ProjectName">
                ISP DDK
            </div>
        </div>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div id="MSearchBoxContainer">
          <img id="MSearchSelect" src="search.png" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()" alt="">
          <input type="text" id="MSearchField" value="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event)">
          <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()">
              <img id="MSearchCloseImg" border="0" src="search/close.png" alt="">
          </a>
          </div>
        </div>
      <div class="clearer"></div>
    </div>
</div>
<div id="NavContainer">
<nav>
    <ul>
        <li><a href="../index.html">Documents</a></li>
        <li id="NavCurrent"><a href="index.html">Source</a>
        <ul>
          <li><a href="pages.html">Related pages</a></li>
          <li><a href="modules.html">Modules</a></li>
          <li><a href="namespaces.html">Namespaces</a></li>
          <li><a href="annotated.html">Data structures</a></li>
          <li><a href="files.html">Files</a></li>
        </ul>
        </li>
    </ul>
</nav>
<div class="clearer"></div>
</div>
<div id="Content">
<div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Sensor Module Implementation Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Sensor API is intended to be easy to add custom sensors to. The API defines a set of functions that a sensor driver should support to allow the Felix AAA algorithms and applications to interact with the sensor to produce a correctly exposed image of the required format.</p>
<h1>Sensor API</h1>
<p>To add a sensor add an entry providing the sensor name to the Sensors array in felix_dev_sensors.c and add a pointer to its Initialise function.</p>
<p>e.g. </p>
<pre class="fragment">IMG_RESULT (*InitialiseSensors[])(SENSOR_HANDLE *phHandle) =
{
    DummyCamCreate,
    DGCamCreate,
    AR330CamCreate,
    P401CamCreate,
    NewCamCreate
};

char *Sensors[]={
    "Dummy Camera",
    "Data Generator",
    "AR330 Camera",
    "P401 Camera",
    "MyNewCam"
};
</pre><p>The initialise function should fill in a /a SENSOR_FUNCS structure to point to the functions used to control the sensor, and return this as a handle that the user can use to call the sensor control functions. In order to keep some state it is recommended to place this at the start of a larger camera context structure</p>
<p>e.g.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>_newcam_struct</div>
<div class="line">   {</div>
<div class="line">     <a class="code" href="struct___sensor___functions__.html">SENSOR_FUNCS</a> sFuncs;</div>
<div class="line">     <a class="code" href="c99_2img__systypes_8h.html#aa21d0a3c41a4e98106aa1196e6dd17c0">IMG_UINT16</a> ui16CurrentMode;</div>
<div class="line">     <a class="code" href="img__types_8h.html#a8691029e0deaf3dccc71c6f36b848d6c">IMG_BOOL</a> nEnabled;</div>
<div class="line">     <a class="code" href="c99_2img__systypes_8h.html#afbbcd3ca36cd3bc43d459488cfb99071">IMG_UINT32</a> ui32ExposureMax;</div>
<div class="line">     <a class="code" href="c99_2img__systypes_8h.html#afbbcd3ca36cd3bc43d459488cfb99071">IMG_UINT32</a> ui32Exposure;</div>
<div class="line">     <a class="code" href="c99_2img__systypes_8h.html#afbbcd3ca36cd3bc43d459488cfb99071">IMG_UINT32</a> ui32ExposureMin;</div>
<div class="line">     <a class="code" href="c99_2img__systypes_8h.html#a34f7c7cd7777d317713dd709e44f14d5">IMG_UINT8</a> ui8MipiLanes;</div>
<div class="line">     SENSOR_I2C * psI2C;</div>
<div class="line">     <span class="keywordtype">double</span> flGain;</div>
<div class="line">   }NEWCAM_STRUCT;</div>
<div class="line"></div>
<div class="line">   <a class="code" href="img__types_8h.html#acbbd12329a0023857600682f4fdfc05c">IMG_RESULT</a> NewCamCreate(<a class="code" href="struct___sensor___functions__.html">SENSOR_HANDLE</a> *phHandle)</div>
<div class="line">   {</div>
<div class="line">       MYNEWCAM_STRUCT *psCam;</div>
<div class="line"></div>
<div class="line">       psCam=(MYNEWCAMCAM_STRUCT *)<a class="code" href="img__defs_8h.html#ac61395705a5e286358aaf28ee13e80fe">IMG_CALLOC</a>(<span class="keyword">sizeof</span>(MYNEWCAMCAM_STRUCT), 1);</div>
<div class="line">       <span class="keywordflow">if</span>(!psCam)</div>
<div class="line">           <span class="keywordflow">return</span> <a class="code" href="img__errors_8h.html#a8e2b1545ca4c08c38ce55a69440326d2">IMG_ERROR_MALLOC_FAILED</a>;</div>
<div class="line"></div>
<div class="line">        phHandle=(<span class="keywordtype">void</span>*)psCam;</div>
<div class="line">       psCam-&gt;sFuncs.GetSensorModes=MYNEWCAM_GetSensorModes;</div>
<div class="line">       psCam-&gt;sFuncs.GetSensorState=MYNEWCAM_GetSensorState;</div>
<div class="line">       psCam-&gt;sFuncs.SetSensorMode=MYNEWCAM_SetSensorMode;</div>
<div class="line">       psCam-&gt;sFuncs.EnableSensor=MYNEWCAM_EnableSensor;</div>
<div class="line">       psCam-&gt;sFuncs.DisableSensor=MYNEWCAM_DisableSensor;</div>
<div class="line">       psCam-&gt;sFuncs.DestroySensor=MYNEWCAM_DestroySensor;</div>
<div class="line"></div>
<div class="line">       <span class="comment">//psCam-&gt;sFuncs.GetCurrentFocus stays NULL so is Unsupported;</span></div>
<div class="line">       <span class="comment">//psCam-&gt;sFuncs.GetFocusRange stays NULL so is Unsupported;</span></div>
<div class="line">       <span class="comment">//psCam-&gt;sFuncs.SetFocus stays NULL so is Unsupported;</span></div>
<div class="line"></div>
<div class="line">       psCam-&gt;sFuncs.<a class="code" href="struct___sensor___functions__.html#a14f655df7b2ed0cced61853f79ea0910">GetCurrentGain</a>=MYNEWCAM_GetGain;</div>
<div class="line">       psCam-&gt;sFuncs.GetGainRange=MYNEWCAM_GetGainRange;</div>
<div class="line">       psCam-&gt;sFuncs.SetGain=MYNEWCAM_SetGain;</div>
<div class="line"></div>
<div class="line">       psCam-&gt;sFuncs.SetExposure=MYNEWCAM_SetExposure;</div>
<div class="line">       psCam-&gt;sFuncs.GetExposureRange=MYNEWCAM_GetExposureRange;</div>
<div class="line">       psCam-&gt;sFuncs.GetExposure=MYNEWCAM_GetExposure;</div>
<div class="line">       </div>
<div class="line">       psCam-&gt;nEnabled=0;</div>
<div class="line">       psCam-&gt;ui16CurrentMode=0;</div>
<div class="line"></div>
<div class="line">       psCam-&gt;psI2C= SensorI2CInit(0,0x20,0x21,400*1000,<a class="code" href="img__types_8h.html#a94b59464c38d931437759523832e6967">IMG_TRUE</a>);</div>
<div class="line"></div>
<div class="line">       <a class="code" href="group___f_e_l_i_x___c_o_m_m_o_n.html#ga378e28bfcb78d17285210d6bbb70a083">LOG_INFO</a>(<span class="stringliteral">&quot;Sensor initialised\n&quot;</span>);</div>
<div class="line">       <span class="keywordflow">return</span> <a class="code" href="img__errors_8h.html#ad0d434b68b5369e6fab16fb96e18c97f">IMG_SUCCESS</a>;</div>
<div class="line">   }</div>
</div><!-- fragment --><p>The Initialise function will probably need to get a handle to the I2C subsytem as shown above, by calling the SensorI2CInit() function. It can then use this to call the SensorI2CWrite8(), SensorI2CWrite16(),SensorI2CRead8(),SensorI2CRead16() functions and also to call the DoGasket() function which must be called just before a sensor is enabled</p>
<p>Other issues which may need to be taken into account. If the SOC has an external gasket then this will need to be configured. In this case the doGasket function should be modified to do whatever is required </p>
</div></div><!-- contents -->

<div class="footer">
    &copy; Copyright 2016, Imagination Technologies.
</div>
<!-- Back-to-top -->
<a href="#" class="back-to-top">&#8593; TOP</a>
<script>            
    jQuery(document).ready(function() {
    var offset = 220;
        var duration = 500;
        jQuery(window).scroll(function() {
            if (jQuery(this).scrollTop() > offset) {
                jQuery('.back-to-top').fadeIn(duration);
            } else {
                jQuery('.back-to-top').fadeOut(duration);
            }
        });
        jQuery('.back-to-top').click(function(event) {
            event.preventDefault();
            jQuery('html, body').animate({scrollTop: 0}, duration);
            return false;
        })
    });
</script>
<!-- End Back-to-top -->
</body>
</html>
