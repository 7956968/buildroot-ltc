<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Vision Libraries Usage Instructions &mdash; ISP DDK 2.8.4 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/fonts/open-sans/open-sans-font.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.8.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/img.ico"/>
    <link rel="top" title="ISP DDK 2.8.4 documentation" href="index.html" />
    <link rel="next" title="Frequently Asked Questions" href="faq.html" />
    <link rel="prev" title="Android Build Instructions" href="android/hal_build_instructions.html" /> 
  </head>
  <body role="document">
<div id="HeaderContainer">
    <div id="Header">
        <div id="HeaderContent">
            <div id="HeaderLogo">
                <a href="index.html"><img src="_static/images/doc-logo.png" /></a>
            </div>
            <div id="ProjectName">
                ISP DDK
            </div>
        </div>
        <div id="searchbox">
            <form class="search" action="search.html" method="get">
              <input type="text" name="q" size="12" />
              <input type="submit" value="">
            </form>
        </div>
      <div class="clearer"></div>
    </div>
</div>
<div id="NavContainer">
<nav>
    <ul>
        <li id="NavCurrent"><a href="index.html">Documents</a></li>
        <li><a href="index/../doxygen/index.html">Source</a>
        <ul>
          <li><a href="index/../doxygen/pages.html">Related pages</a></li>
          <li><a href="index/../doxygen/modules.html">Modules</a></li>
          <li><a href="index/../doxygen/namespaces.html">Namespaces</a></li>
          <li><a href="index/../doxygen/annotated.html">Data structures</a></li>
          <li><a href="index/../doxygen/files.html">Files</a></li>
        </ul>
        </li>
    </ul>
</nav>

<div class="clearer"></div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="faq.html" title="Frequently Asked Questions"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="android/hal_build_instructions.html" title="Android Build Instructions"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Home</a> &raquo;</li><li>Vision Libraries Usage Instructions</li>
      </ul>
    </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="vision-libraries-usage-instructions">
<span id="isp-vision-libraries-usage-instructions"></span><h1>Vision Libraries Usage Instructions<a class="headerlink" href="#vision-libraries-usage-instructions" title="Permalink to this headline">¶</a></h1>
<p>The CameraGPU library is a wrapper for a set of GPU based image processing
functions, intended for real time processing of video data to allow advanced
functionality for the Android Camera HAL. These functions are optimised for
the PowerVR architecture and provide</p>
<ul class="simple">
<li>Face Detection and</li>
<li>Image Stabilisation</li>
<li>Rolling Shutter Correction</li>
</ul>
<p>The CameraGPU library is for Android and wrappers the libPVRVision
Linux/Android libraries. This document comes with the CameraGPU library and
describes how to build this library. The <a class="reference internal" href="android/hal_build_instructions.html#isp-android-build-instructions"><span>V2500 DDK Android Build
Instructions document</span></a> describes how to
integrate these functions with the V2500 Camera HAL.</p>
<p>Vision stabilisation and rolling shutter are combined in one library
<code class="docutils literal"><span class="pre">libPVRVisionStabilisation.so</span></code>. Face detection is performed by
<code class="docutils literal"><span class="pre">libPVRFaceDetect.so</span></code>. Both libraries use <code class="docutils literal"><span class="pre">libPVRVisionCore</span></code>.</p>
<div class="section" id="code-structure-and-usage">
<h2>Code structure and usage<a class="headerlink" href="#code-structure-and-usage" title="Permalink to this headline">¶</a></h2>
<p>The vision libraries code needs to be placed in:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>Android_root_path/hardware/img/gpu
</pre></div>
</div>
<p>Symbolic link <code class="docutils literal"><span class="pre">gpu</span></code> to vision_libraries folder will be sufficient.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>Android_root_path/hardware/img
<span class="nv">$ </span>ln -s VisionLibrariesPath/vision_libraries gpu
</pre></div>
</div>
</div>
<div class="section" id="build-instructions">
<h2>Build instructions<a class="headerlink" href="#build-instructions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="setup-environment">
<h3>Setup environment<a class="headerlink" href="#setup-environment" title="Permalink to this headline">¶</a></h3>
<p>In android root folder:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>. build/envsetup.sh
<span class="nv">$ </span>lunch android_x86-eng
</pre></div>
</div>
</div>
<div class="section" id="apply-patches">
<h3>Apply patches<a class="headerlink" href="#apply-patches" title="Permalink to this headline">¶</a></h3>
<p>The patches which need to be applied for cameragpu library to work properly are
in vision_libraries/patches folder and can be accessed through symbolic link gpu.</p>
<div class="section" id="build-add-cascade-bin">
<h4>build_add_cascade.bin<a class="headerlink" href="#build-add-cascade-bin" title="Permalink to this headline">¶</a></h4>
<p>The patch <code class="docutils literal"><span class="pre">build_add_cascade.bin</span></code> allows to copy <code class="docutils literal"><span class="pre">cascade.bin</span></code> file into
<code class="docutils literal"><span class="pre">/system/bin</span></code> of <code class="docutils literal"><span class="pre">system.img</span></code> during android compilation. The <code class="docutils literal"><span class="pre">cascade.bin</span></code>
is used by face detection library.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>croot
<span class="nv">$ </span><span class="nb">cd </span>build
<span class="nv">$ </span>patch –p1 &lt; ../hardware/img/gpu/patches/build_add_cascade.bin.patch
<span class="nv">$ </span>croot
<span class="nv">$ </span>make
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">make</span></code> command will build android and copy <code class="docutils literal"><span class="pre">cascade.bin</span></code> into
appropriate location in order to be included in <code class="docutils literal"><span class="pre">system.img</span></code>.</p>
</div>
</div>
<div class="section" id="build-libraries">
<h3>Build libraries<a class="headerlink" href="#build-libraries" title="Permalink to this headline">¶</a></h3>
<p>In android root folder</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>make libcameragpu
</pre></div>
</div>
</div>
<div class="section" id="use-cameragpu">
<h3>Use CameraGPU<a class="headerlink" href="#use-cameragpu" title="Permalink to this headline">¶</a></h3>
<p>In order to use <code class="docutils literal"><span class="pre">cameragpu</span></code> functionality:</p>
<ul class="simple">
<li>modify code</li>
<li>modify Android.mk</li>
</ul>
<div class="section" id="code">
<h4>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h4>
<p>Include <code class="docutils literal"><span class="pre">camegagpu_api.h</span></code> and calls to CameraGPU functions in your code.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#include &quot;cameragpu_api.h&quot;</span>
</pre></div>
</div>
<p>Define pointer to <code class="docutils literal"><span class="pre">camera_gpu</span></code> object;</p>
<div class="highlight-bash"><div class="highlight"><pre>camera_gpu *mGPU<span class="p">;</span>
</pre></div>
</div>
<p>Create cameragpu class object. Provide the size of the input image.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">mGPU</span> <span class="o">=</span> <span class="n">new</span> <span class="n">camera_gpu</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">);</span>
</pre></div>
</div>
<p>Call API functions.
There are two functional areas grouped by CameraGPU API</p>
<ul class="simple">
<li>image stabilisation/rolling shutter</li>
<li>face detection</li>
</ul>
<div class="section" id="image-stabilisation-rolling-shutter">
<h5>Image stabilisation/rolling shutter<a class="headerlink" href="#image-stabilisation-rolling-shutter" title="Permalink to this headline">¶</a></h5>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">status_t</span> <span class="nf">gpuGetStabilizedFrame</span><span class="p">(</span> <span class="kt">int64_t</span>               <span class="n">inTimeStamp</span><span class="p">,</span>
                                <span class="kt">uint8_t</span> <span class="k">const</span> <span class="o">*</span> <span class="k">const</span> <span class="n">inYUV</span><span class="p">,</span>
                                <span class="kt">uint8_t</span>       <span class="o">*</span> <span class="k">const</span> <span class="n">outYUV</span><span class="p">);</span>
</pre></div>
</div>
<p>The inputYuvFrame and outputYuvFrame can be the same pointer.</p>
</div>
<div class="section" id="face-detection">
<h5>Face detection<a class="headerlink" href="#face-detection" title="Permalink to this headline">¶</a></h5>
<p>Obtain max possible detected faces. This is needed to allocate space for array of detected faces for early allocation.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">status_t</span> <span class="nf">gpuGetMaxFaces</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span> <span class="k">const</span> <span class="n">outNumFaces</span><span class="p">);</span>
</pre></div>
</div>
<p>Obtain actual number of detected faces.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">status_t</span> <span class="nf">gpuGetNumFaces</span><span class="p">(</span> <span class="kt">uint8_t</span> <span class="o">*</span> <span class="k">const</span> <span class="n">outNumFaces</span><span class="p">);</span>
</pre></div>
</div>
<p>Detect faces and obtain pointer to location where result is stored.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">status_t</span> <span class="nf">gpuDetectFaces</span><span class="p">(</span> <span class="kt">uint8_t</span> <span class="k">const</span> <span class="o">*</span> <span class="k">const</span> <span class="n">inYUV</span><span class="p">);</span>
<span class="kt">status_t</span> <span class="nf">gpuGetMetaData</span><span class="p">(</span> <span class="kt">camera_frame_metadata_t</span> <span class="o">**</span><span class="n">mdata</span><span class="p">);</span>
</pre></div>
</div>
<p>Detect faces providing the storage for location where results will be stored.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">status_t</span> <span class="nf">gpuDetectFaces</span><span class="p">(</span> <span class="kt">uint8_t</span> <span class="k">const</span> <span class="o">*</span> <span class="k">const</span> <span class="n">inYUV</span><span class="p">,</span>
                     <span class="kt">camera_frame_metadata_t</span> <span class="o">*</span><span class="n">mdata</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="android-mk">
<h4>Android.mk<a class="headerlink" href="#android-mk" title="Permalink to this headline">¶</a></h4>
<p>Provide path to <code class="docutils literal"><span class="pre">cameragpu_api.h</span></code>.</p>
<div class="highlight-make"><div class="highlight"><pre><span class="nv">GPU_TOP</span><span class="o">:=</span><span class="k">$(</span>ANDROID_BUILD_TOP<span class="k">)</span>/hardware/img/gpu
<span class="nv">LOCAL_C_INCLUDES</span> <span class="o">+=</span> <span class="k">$(</span>GPU_TOP<span class="k">)</span>/include
</pre></div>
</div>
<p>Link to CameraGPU library.</p>
<div class="highlight-make"><div class="highlight"><pre><span class="nv">LOCAL_SHARED_LIBRARIES</span> <span class="o">+=</span> libcameragpu
</pre></div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Vision Libraries Usage Instructions</a><ul>
<li><a class="reference internal" href="#code-structure-and-usage">Code structure and usage</a></li>
<li><a class="reference internal" href="#build-instructions">Build instructions</a><ul>
<li><a class="reference internal" href="#setup-environment">Setup environment</a></li>
<li><a class="reference internal" href="#apply-patches">Apply patches</a><ul>
<li><a class="reference internal" href="#build-add-cascade-bin">build_add_cascade.bin</a></li>
</ul>
</li>
<li><a class="reference internal" href="#build-libraries">Build libraries</a></li>
<li><a class="reference internal" href="#use-cameragpu">Use CameraGPU</a><ul>
<li><a class="reference internal" href="#code">Code</a><ul>
<li><a class="reference internal" href="#image-stabilisation-rolling-shutter">Image stabilisation/rolling shutter</a></li>
<li><a class="reference internal" href="#face-detection">Face detection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#android-mk">Android.mk</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="android/hal_build_instructions.html"
                        title="previous chapter">Android Build Instructions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="faq.html"
                        title="next chapter">Frequently Asked Questions</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer">
        &copy; Imagination Technologies
    - Strictly Confidential - External
    <br>
     Built on Fri, 05 Aug 2016 13:03:49
    - Revision: <a href="#">4173926</a>
    - <a href="index/../_pdf/manual.pdf">Printable version</a>
</div>

<!-- Embed tables in a scroller-div -->
<script type="text/javascript">
    $( "table.docutils" ).wrap( "<div class='docutils-scroller'></div>" );
</script>
<!-- End Embed tables in a scroller-div -->

<!-- Back-to-top -->
<a href="#" class="back-to-top">&#8593; TOP</a>
<script>            
    jQuery(document).ready(function() {
    var offset = 220;
        var duration = 500;
        jQuery(window).scroll(function() {
            if (jQuery(this).scrollTop() > offset) {
                jQuery('.back-to-top').fadeIn(duration);
            } else {
                jQuery('.back-to-top').fadeOut(duration);
            }
        });

        jQuery('.back-to-top').click(function(event) {
            event.preventDefault();
            jQuery('html, body').animate({scrollTop: 0}, duration);
            return false;
        })
    });
</script>
<!-- End Back-to-top -->
  </body>
</html>